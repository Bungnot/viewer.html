<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ö‡∏±‡πâ‡∏á‡πÑ‡∏ü‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡∏¢</title>
  <style>
    :root{
      --bg:#071225;
      --bg2:#0b1b35;
      --card:#0e203d;
      --card2:#12284a;
      --line:rgba(255,255,255,.10);
      --text:#eaf1ff;
      --muted:#9db0cc;
      --primary:#33c3ff;
      --primary2:#18e0c4;
      --success:#22c55e;
      --danger:#ef4444;
      --warn:#f59e0b;
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --radius:20px; /* ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏Ç‡∏≠‡∏ö‡∏°‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏î‡∏π‡∏™‡∏ö‡∏≤‡∏¢‡∏ï‡∏≤ */
    }

    *{box-sizing:border-box}
    html,body{margin:0;padding:0}
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, sans-serif;
      color:var(--text);
      background:
        radial-gradient(600px 250px at 10% 0%, rgba(51,195,255,.18), transparent 60%),
        radial-gradient(600px 300px at 100% 0%, rgba(24,224,196,.10), transparent 55%),
        linear-gradient(180deg,var(--bg), #050d1b 75%);
      min-height:100vh;
      font-size: 18px; /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏ */
    }

    /* --- ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö (Welcome Screen) --- */
    #welcome-screen {
      position: fixed;
      inset: 0;
      background: var(--bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 99999;
      padding: 20px;
      text-align: center;
    }
    .welcome-btn {
      background: var(--primary);
      color: #000;
      border: none;
      padding: 30px 20px;
      border-radius: var(--radius);
      font-size: 2.2rem;
      font-weight: 900;
      cursor: pointer;
      box-shadow: 0 0 30px rgba(51,195,255,0.4);
      width: 100%;
      max-width: 450px;
      line-height: 1.4;
      animation: pulse 2s infinite;
    }
    .welcome-sub {
      margin-top: 25px;
      font-size: 1.8rem;
      color: var(--primary);
      font-weight: bold;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.03); }
      100% { transform: scale(1); }
    }
    /* --------------------------------- */

    .app{
      max-width: 1180px;
      margin: 0 auto;
      padding: 15px 15px 100px;
    }

    /* Header */
    .hero{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:2px solid var(--primary);
      border-radius: 22px;
      padding: 20px;
      box-shadow: var(--shadow);
      position: sticky;
      top: 10px;
      z-index: 5;
      backdrop-filter: blur(10px);
      text-align: center;
    }
    .hero h1{
      margin:0;
      font-size:1.6rem;
      line-height:1.3;
      font-weight:800;
      color: var(--primary);
    }
    .hero p{
      margin:8px 0 0;
      color:var(--text);
      font-size:1.1rem;
      line-height:1.4;
    }

    .search-wrap{
      margin-top:15px;
      display:flex;
      gap:8px;
      align-items:center;
      background: rgba(0,0,0,0.3);
      border: 1px solid var(--primary);
      border-radius: 16px;
      padding: 12px 15px;
    }
    .search-wrap span { font-size: 1.5rem; }
    .search-wrap input{
      flex:1;
      border:none;
      background:transparent;
      color:var(--text);
      outline:none;
      font-size:1.3rem;
    }
    .search-wrap input::placeholder{color:#8ea5c7}
    .clear-btn{
      border:none;
      background:rgba(255,255,255,.1);
      color:white;
      border-radius:10px;
      padding:8px 15px;
      font-size:1rem;
      cursor:pointer;
      display:none;
    }

    /* Layout */
    .grid{
      margin-top:20px;
      display:grid;
      grid-template-columns:1fr;
      gap:20px;
    }
    @media (min-width: 980px){
      .grid{grid-template-columns: 0.95fr 1.05fr;}
    }

    .panel{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panel-head{
      padding:15px 20px;
      border-bottom:1px solid rgba(255,255,255,.06);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      background:rgba(255,255,255,.03);
    }
    .panel-head .title{
      font-weight:800;
      font-size:1.3rem;
      color: var(--primary);
    }
    .panel-head .sub{
      color:var(--muted);
      font-size:1rem;
      white-space:nowrap;
    }
    .panel-body{padding:15px}

    /* Camp list */
    .camp-list{
      display:flex;
      flex-direction:column;
      gap:15px;
      max-height: 62vh;
      overflow:auto;
      padding-right:5px;
    }
    @media (max-width: 979px){
      .camp-list{max-height:none}
    }
    .camp-item{
      border:2px solid transparent;
      border-radius:16px;
      background: var(--card2);
      padding:15px;
      display:flex;
      flex-direction: column;
      gap:12px;
    }
    .camp-item.active{
      border-color: var(--primary);
      box-shadow: 0 0 15px rgba(51,195,255,.2);
      background: #1a3661;
    }
    .camp-left{ min-width:0; }
    .camp-title{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:800;
      font-size:1.4rem;
      margin-bottom:8px;
      min-width:0;
    }
    .rank{
      min-width:32px;height:32px;
      display:inline-flex;align-items:center;justify-content:center;
      border-radius:999px;
      font-size:1rem;
      color:#000;
      background:linear-gradient(135deg,var(--primary),var(--primary2));
      font-weight:800;
    }
    .camp-name{
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .camp-meta{
      color:var(--text);
      font-size:1rem;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      line-height:1.4;
    }
    .camp-meta span {
      background: rgba(0,0,0,0.2);
      padding: 4px 8px;
      border-radius: 6px;
    }
    .camp-btn{
      border:none;
      border-radius:12px;
      padding:15px 20px;
      width: 100%;
      color:#000;
      font-weight:900;
      font-size:1.2rem;
      background:linear-gradient(135deg,var(--primary),var(--primary2));
      cursor:pointer;
      box-shadow: 0 4px 15px rgba(51,195,255,0.3);
    }

    /* Detail */
    .detail-empty{
      border:2px dashed rgba(255,255,255,.2);
      border-radius:16px;
      padding:30px 15px;
      color:var(--text);
      text-align:center;
      font-size:1.2rem;
      line-height:1.5;
    }

    .detail-top{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-bottom:15px;
    }
    .detail-title{
      font-size:1.8rem;
      font-weight:900;
      line-height:1.35;
      color: var(--primary);
      word-break:break-word;
    }
    .detail-hint{
      color:var(--muted);
      font-size:1.1rem;
    }

    .inline-actions{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    .mini-btn{
      border:1px solid var(--line);
      background:rgba(255,255,255,.1);
      color:white;
      border-radius:10px;
      padding:10px 15px;
      font-size:1rem;
      font-weight:700;
      cursor:pointer;
    }
    .mini-btn.danger{ border-color:var(--danger); background:rgba(239,68,68,.1); color:#ffc0c0; }

    .stats{
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:12px;
      margin:15px 0;
    }
    .stat{
      border:1px solid var(--line);
      border-radius:14px;
      padding:15px;
      background: rgba(255,255,255,.05);
      text-align: center;
    }
    .stat.big{
      grid-column:1/-1;
      background: linear-gradient(135deg, rgba(51,195,255,.15), rgba(24,224,196,.08));
      border: 2px solid var(--primary);
    }
    .stat .label{
      color:var(--muted);
      font-size:1rem;
      margin-bottom:8px;
    }
    .stat .val{
      font-weight:900;
      font-size:1.5rem;
      color: #fff;
    }
    .stat.big .val { font-size: 2.2rem; color: var(--primary2); }

    .legend{
      display:flex; flex-wrap:wrap; gap:10px;
      margin-bottom:15px; justify-content: center;
    }
    .legend span{
      border:1px solid var(--line);
      background:rgba(255,255,255,.05);
      border-radius:999px;
      padding:8px 12px;
      font-size:1rem;
      color:var(--text);
    }

    .history-list{
      display:flex;
      flex-direction:column;
      gap:12px;
      max-height: 52vh;
      overflow:auto;
      padding-right:5px;
    }
    @media (max-width: 979px){
      .history-list{max-height:none}
    }

    .history{
      border:1px solid var(--line);
      border-radius:14px;
      padding:15px;
      background: var(--card2);
    }
    .history-line{
      font-weight:800;
      font-size:1.3rem;
      line-height:1.4;
      word-break:break-word;
    }
    .history-row{
      margin-top:10px;
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      color:var(--text);
      font-size:1.1rem;
    }
    .pill{
      border-radius:999px;
      padding:6px 12px;
      font-size:1rem;
      font-weight:800;
      border:1px solid transparent;
    }
    .pill.win{background:rgba(34,197,94,.2);border-color:rgba(34,197,94,.4);color:#a7f3c1}
    .pill.lose{background:rgba(239,68,68,.2);border-color:rgba(239,68,68,.4);color:#fecaca}
    .pill.jao{background:rgba(245,158,11,.2);border-color:rgba(245,158,11,.4);color:#fde68a}

    /* Admin FAB */
    .fab{
      position:fixed;
      right:20px; bottom:20px;
      z-index:30;
      border:none;
      border-radius:999px;
      padding:15px 20px;
      font-weight:900;
      font-size: 1.2rem;
      color:#fff;
      cursor:pointer;
      background: linear-gradient(135deg,#7c3aed,#2563eb);
      box-shadow: 0 10px 24px rgba(37,99,235,.5);
    }

    /* Modal */
    .modal{
      position:fixed; inset:0;
      background: rgba(2,6,23,.85);
      display:none;
      align-items:flex-end;
      justify-content:center;
      z-index:50;
      padding:0;
    }
    .modal.show{display:flex}
    .sheet{
      width:100%;
      max-width:760px;
      background:#091324;
      border:1px solid var(--line);
      border-radius:24px 24px 0 0;
      max-height:90vh;
      overflow:auto;
      box-shadow: var(--shadow);
    }
    @media (min-width:700px){
      .modal{align-items:center; padding:20px;}
      .sheet{border-radius:24px;}
    }
    .sheet-head{
      position:sticky;
      top:0;
      background:#091324;
      z-index:1;
      border-bottom:1px solid rgba(255,255,255,.1);
      padding:15px 20px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
    }
    .sheet-title{font-weight:900; font-size:1.4rem;}
    .x-btn{
      border:1px solid var(--line);
      background:rgba(255,255,255,.1);
      color:white;
      border-radius:12px;
      padding:10px 15px;
      font-size: 1.1rem;
      cursor:pointer;
    }
    .sheet-body{padding:20px; display:grid; gap:15px;}

    .status-box{
      border:1px solid var(--line);
      border-radius:14px;
      padding:15px;
      background: rgba(255,255,255,.05);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .status-text{font-size:1.1rem;color:var(--text)}

    .card{
      border:1px solid var(--line);
      border-radius:16px;
      background: rgba(255,255,255,.03);
      padding:20px;
    }
    .card h3{
      margin:0 0 15px;
      font-size:1.3rem;
      color: var(--primary);
    }

    .form-grid{
      display:grid;
      grid-template-columns:1fr;
      gap:12px;
    }
    @media (min-width:650px){
      .form-grid.cols-2{grid-template-columns:1fr 1fr}
      .form-grid.cols-3{grid-template-columns:1fr 1fr 1fr}
    }
    .field{display:grid; gap:8px}
    .field label{font-size:1rem;color:var(--muted)}
    .field input,.field select{
      width:100%;
      border:1px solid var(--line);
      background:rgba(255,255,255,.05);
      color:white;
      outline:none;
      border-radius:12px;
      padding:15px;
      font-size:1.2rem;
    }

    .action-row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:15px;
    }
    .main-btn{
      border:none;
      border-radius:14px;
      padding:15px 20px;
      color:#fff;
      font-size:1.2rem;
      font-weight:900;
      cursor:pointer;
      width: 100%;
    }
    @media (min-width:650px){ .main-btn { width: auto; } }
    .main-btn.primary{background:linear-gradient(135deg,var(--primary),var(--primary2)); color:#000;}
    .main-btn.green{background:linear-gradient(135deg,#16a34a,#22c55e)}
    .main-btn.gray{
      background:rgba(255,255,255,.1);
      border:1px solid var(--line);
      color:var(--text);
    }

    .note{margin-top:10px; color:var(--muted); font-size:1rem; line-height:1.4}
  </style>
</head>
<body>

  <div id="welcome-screen">
    <button class="welcome-btn" onclick="startApp()">
      ‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥<br>‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡∏¢
    </button>
    <div class="welcome-sub">* ‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏ñ‡πâ‡∏≤‡πÅ‡∏Å‡πà‡∏ô‡πâ‡∏≠‡∏¢ *</div>
  </div>

  <div class="app">
    <section class="hero">
      <h1>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ö‡∏±‡πâ‡∏á‡πÑ‡∏ü‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡∏¢</h1>
      <p>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‚Ä¢ ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö‡πÑ‡∏î‡πâ</p>
      <div class="search-wrap">
        <span>üîé</span>
        <input id="searchInput" type="text" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡∏¢ ‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏ö‡∏á‡∏Ñ‡πå‡∏ó‡∏≠‡∏á..." />
        <button id="clearSearchBtn" class="clear-btn">‡∏•‡πâ‡∏≤‡∏á</button>
      </div>
    </section>

    <div class="grid">
      <section class="panel">
        <div class="panel-head">
          <div class="title">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡∏¢</div>
          <div id="campCount" class="sub">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
        </div>
        <div class="panel-body">
          <div id="campList" class="camp-list">
            <div class="sub" style="font-size:1.2rem;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
          </div>
        </div>
      </section>

      <section class="panel">
        <div class="panel-head">
          <div class="title">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div>
          <div id="selectedCampTag" class="sub">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</div>
        </div>
        <div id="detailPanel" class="panel-body">
          <div class="detail-empty">
            ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô<br>‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î <b style="color:var(--primary);">‚Äú‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‚Äù</b> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
          </div>
        </div>
      </section>
    </div>
  </div>

  <button id="adminFab" class="fab">üîê ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</button>

  <div id="adminModal" class="modal">
    <div class="sheet">
      <div class="sheet-head">
        <div class="sheet-title">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô)</div>
        <button id="closeAdminModal" class="x-btn">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
      </div>
      <div class="sheet-body">
        <div class="status-box">
          <div id="adminStateText" class="status-text">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</div>
          <button id="logoutBtn" class="main-btn gray" style="display:none;">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>

        <div id="adminLoginCard" class="card">
          <h3>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h3>
          <div class="form-grid cols-2">
            <div class="field" style="grid-column:1/-1">
              <label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</label>
              <input type="email" id="adminEmailInput" placeholder="admin@email.com">
            </div>
            <div class="field" style="grid-column:1/-1">
              <label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
              <input type="password" id="adminPasswordInput" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
            </div>
          </div>
          <div class="action-row">
            <button id="loginBtn" class="main-btn primary">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
          </div>
        </div>

        <div id="adminAddCampCard" class="card" style="display:none;">
          <h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà</h3>
          <div class="form-grid cols-2">
            <div class="field" style="grid-column:1/-1">
              <label>‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡∏¢</label>
              <input type="text" id="newCampName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏ö‡∏á‡∏Ñ‡πå‡∏ó‡∏≠‡∏á">
            </div>
          </div>
          <div class="action-row">
            <button id="addCampBtn" class="main-btn green">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤‡∏¢</button>
          </div>
        </div>

        <div id="adminAddRecordCard" class="card" style="display:none;">
          <h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ / ‡∏™‡∏Å‡∏≠‡∏£‡πå‡∏ö‡∏±‡πâ‡∏á‡πÑ‡∏ü</h3>
          <div class="form-grid cols-3">
            <div class="field">
              <label>‡∏Ñ‡πà‡∏≤‡∏¢</label>
              <select id="recordCampSelect"></select>
            </div>
            <div class="field">
              <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
              <input type="date" id="recordDate">
            </div>
            <div class="field">
              <label>‡∏™‡∏Å‡∏≠‡∏£‡πå</label>
              <input type="number" id="recordScore" min="0" placeholder="355">
            </div>
            <div class="field" style="grid-column:1/-1">
              <label>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</label>
              <select id="recordResult">
                <option value="win">‚úÖ ‡∏ä‡∏ô‡∏∞</option>
                <option value="lose">‚ùå ‡πÅ‡∏û‡πâ</option>
                <option value="jao">‚õîÔ∏è ‡∏à‡∏≤‡∏ß</option>
              </select>
            </div>
          </div>
          <div class="action-row">
            <button id="addRecordBtn" class="main-btn primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>
          </div>
          <div class="note">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: 24/02/69 > ‡πÅ‡∏ö‡∏á‡∏Ñ‡πå‡∏ó‡∏≠‡∏á = 355 ‚õîÔ∏è‚õîÔ∏è</div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getAuth,
      signInWithEmailAndPassword,
      signOut,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import {
      getFirestore,
      collection,
      addDoc,
      onSnapshot,
      serverTimestamp,
      doc,
      updateDoc,
      deleteDoc,
      query,
      where,
      getDocs,
      writeBatch
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // ‚úÖ ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏´‡πâ‡∏≤‡∏°‡∏Ç‡∏≤‡∏î‡∏´‡∏≤‡∏¢)
    const firebaseConfig = {
      apiKey: "AIzaSyBo2QyLIW5q6AFAtTYLrqBr5wgssYvwgPI",
      authDomain: "webscorebungfire.firebaseapp.com",
      projectId: "webscorebungfire",
      storageBucket: "webscorebungfire.firebasestorage.app",
      messagingSenderId: "1088110071642",
      appId: "1:1088110071642:web:037a36b00e84aa432ead63"
    };

    const ADMIN_EMAIL = "thebungnot10@gmail.com";

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const state = {
      camps: [],
      records: [],
      selectedCampId: null,
      isAdmin: false,
      currentUserEmail: null
    };

    const RESULT_META = {
      win:  { label: "‡∏ä‡∏ô‡∏∞", icon: "‚úÖ", className: "win", weight: 1.0 },
      lose: { label: "‡πÅ‡∏û‡πâ", icon: "‚ùå", className: "lose", weight: 0.0 },
      jao:  { label: "‡∏à‡∏≤‡∏ß", icon: "‚õîÔ∏è", className: "jao", weight: 0.4 }
    };

    const el = {
      searchInput: document.getElementById("searchInput"),
      clearSearchBtn: document.getElementById("clearSearchBtn"),
      campList: document.getElementById("campList"),
      campCount: document.getElementById("campCount"),
      detailPanel: document.getElementById("detailPanel"),
      selectedCampTag: document.getElementById("selectedCampTag"),

      adminFab: document.getElementById("adminFab"),
      adminModal: document.getElementById("adminModal"),
      closeAdminModal: document.getElementById("closeAdminModal"),
      adminStateText: document.getElementById("adminStateText"),
      logoutBtn: document.getElementById("logoutBtn"),

      adminLoginCard: document.getElementById("adminLoginCard"),
      adminAddCampCard: document.getElementById("adminAddCampCard"),
      adminAddRecordCard: document.getElementById("adminAddRecordCard"),

      adminEmailInput: document.getElementById("adminEmailInput"),
      adminPasswordInput: document.getElementById("adminPasswordInput"),
      loginBtn: document.getElementById("loginBtn"),

      newCampName: document.getElementById("newCampName"),
      addCampBtn: document.getElementById("addCampBtn"),

      recordCampSelect: document.getElementById("recordCampSelect"),
      recordDate: document.getElementById("recordDate"),
      recordScore: document.getElementById("recordScore"),
      recordResult: document.getElementById("recordResult"),
      addRecordBtn: document.getElementById("addRecordBtn")
    };

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö
    window.startApp = function() {
      document.getElementById('welcome-screen').style.display = 'none';
    }

    function setDefaultDate() {
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      el.recordDate.value = `${y}-${m}-${day}`;
    }

    function formatThaiShort(isoDate) {
      if (!isoDate) return "-";
      const d = new Date(isoDate + "T00:00:00");
      if (isNaN(d.getTime())) return isoDate;
      const dd = String(d.getDate()).padStart(2, "0");
      const mm = String(d.getMonth() + 1).padStart(2, "0");
      const yy = String(d.getFullYear() + 543).slice(-2);
      return `${dd}/${mm}/${yy}`;
    }

    function getMergedCamps() {
      const map = new Map();
      for (const camp of state.camps) map.set(camp.id, { ...camp, records: [] });
      for (const rec of state.records) {
        const target = map.get(rec.campId);
        if (target) target.records.push(rec);
      }
      return Array.from(map.values());
    }

    function getCampById(campId) {
      return getMergedCamps().find(c => c.id === campId) || null;
    }

    function sortRecords(records) {
      return [...records].sort((a, b) => {
        if ((a.date || "") === (b.date || "")) return (b.score || 0) - (a.score || 0);
        return (b.date || "").localeCompare(a.date || "");
      });
    }

    function getStats(camp) {
      const total = camp.records.length;
      const win = camp.records.filter(r => r.result === "win").length;
      const lose = camp.records.filter(r => r.result === "lose").length;
      const jao = camp.records.filter(r => r.result === "jao").length;

      const avgScore = total
        ? Math.round(camp.records.reduce((sum, r) => sum + (Number(r.score) || 0), 0) / total)
        : 0;

      const weighted = total
        ? Math.round((camp.records.reduce((sum, r) => sum + (RESULT_META[r.result]?.weight ?? 0), 0) / total) * 100)
        : 0;

      return {
        total, win, lose, jao, avgScore, weighted,
        winPct: total ? Math.round((win / total) * 100) : 0,
        losePct: total ? Math.round((lose / total) * 100) : 0,
        jaoPct: total ? Math.round((jao / total) * 100) : 0
      };
    }

    function escapeHtml(text) {
      return String(text)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function updateClearSearchBtn() {
      const hasText = !!el.searchInput.value.trim();
      el.clearSearchBtn.style.display = hasText ? "inline-block" : "none";
    }

    function renderCampList() {
      const merged = getMergedCamps();
      const sortedByRecords = [...merged].sort((a, b) => {
        const diff = (b.records?.length || 0) - (a.records?.length || 0);
        if (diff !== 0) return diff;
        return (a.name || "").localeCompare(b.name || "", "th");
      });

      const q = el.searchInput.value.trim().toLowerCase();
      let visible = [];

      if (q) {
        visible = sortedByRecords.filter(c => (c.name || "").toLowerCase().includes(q));
        el.campCount.textContent = `‡∏ú‡∏•‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ${visible.length}/${merged.length}`;
      } else {
        visible = sortedByRecords.slice(0, 3);
        el.campCount.textContent = `‡πÅ‡∏™‡∏î‡∏á 3 ‡∏Ñ‡πà‡∏≤‡∏¢ (‡∏£‡∏ß‡∏° ${merged.length})`;
      }

      el.campList.innerHTML = "";
      updateClearSearchBtn();

      if (!visible.length) {
        const empty = document.createElement("div");
        empty.className = "detail-empty";
        empty.textContent = q ? "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤" : "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏¢";
        el.campList.appendChild(empty);
        return;
      }

      visible.forEach((camp, idx) => {
        const stats = getStats(camp);

        const card = document.createElement("div");
        card.className = "camp-item" + (state.selectedCampId === camp.id ? " active" : "");

        const left = document.createElement("div");
        left.className = "camp-left";
        left.innerHTML = `
          <div class="camp-title">
            <span class="rank">${idx + 1}</span>
            <span class="camp-name">${escapeHtml(camp.name)}</span>
          </div>
          <div class="camp-meta">
            <span>‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${stats.total} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>
            <span>‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô ${stats.weighted}%</span>
            <span>‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ ${stats.avgScore}</span>
          </div>
        `;

        const btn = document.createElement("button");
        btn.className = "camp-btn";
        btn.textContent = "‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ";
        btn.onclick = () => {
          state.selectedCampId = camp.id;
          renderCampList();
          renderDetail();
          // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á‡πÑ‡∏õ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏‡∏Å‡∏î (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å‡πÉ‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠)
          document.getElementById("detailPanel").scrollIntoView({ behavior: "smooth", block: "start" });
        };

        card.appendChild(left);
        card.appendChild(btn);
        el.campList.appendChild(card);
      });
    }

    function renderDetail() {
      const camp = state.selectedCampId ? getCampById(state.selectedCampId) : null;

      if (!camp) {
        el.selectedCampTag.textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å";
        el.detailPanel.innerHTML = `
          <div class="detail-empty">
            ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î ‚Äú‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå
          </div>
        `;
        return;
      }

      el.selectedCampTag.textContent = camp.name;
      const stats = getStats(camp);
      const rows = sortRecords(camp.records);

      let historyHtml = "";
      if (!rows.length) {
        historyHtml = `<div class="detail-empty">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡∏¢‡∏ô‡∏µ‡πâ</div>`;
      } else {
        historyHtml = rows.map(r => {
          const meta = RESULT_META[r.result] || RESULT_META.lose;
          return `
            <div class="history">
              <div class="history-line">${formatThaiShort(r.date)} &gt; ${escapeHtml(camp.name)} = ${r.score} ${meta.icon}${meta.icon}</div>
              <div class="history-row">
                <span class="pill ${meta.className}">${meta.icon} ${meta.label}</span>
                <span>‡∏™‡∏Å‡∏≠‡∏£‡πå ${r.score}</span>
                ${state.isAdmin ? `
                  <span style="margin-left:auto; display:flex; gap:10px;">
                    <button class="mini-btn" onclick="window.editRecordById('${r.id}')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                    <button class="mini-btn danger" onclick="window.deleteRecordById('${r.id}')">‡∏•‡∏ö</button>
                  </span>
                ` : ""}
              </div>
            </div>
          `;
        }).join("");
      }

      el.detailPanel.innerHTML = `
        <div class="detail-top">
          <div class="detail-title">${escapeHtml(camp.name)}</div>
          <div class="detail-hint">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏•‡∏£‡∏ß‡∏°</div>
          ${state.isAdmin ? `
            <div class="inline-actions">
              <button class="mini-btn" onclick="window.renameSelectedCamp()">‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡∏¢</button>
              <button class="mini-btn danger" onclick="window.deleteSelectedCamp()">‡∏•‡∏ö‡∏Ñ‡πà‡∏≤‡∏¢</button>
            </div>
          ` : ""}
        </div>

        <div class="stats">
          <div class="stat big">
            <div class="label">‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏£‡∏ß‡∏° (‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô)</div>
            <div class="val">${stats.weighted}%</div>
          </div>
          <div class="stat">
            <div class="label">‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
            <div class="val">${stats.total} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
          </div>
          <div class="stat">
            <div class="label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div>
            <div class="val">${stats.avgScore}</div>
          </div>
          <div class="stat">
            <div class="label">‡∏ä‡∏ô‡∏∞ ‚úÖ</div>
            <div class="val">${stats.win} (${stats.winPct}%)</div>
          </div>
          <div class="stat">
            <div class="label">‡πÅ‡∏û‡πâ ‚ùå</div>
            <div class="val">${stats.lose} (${stats.losePct}%)</div>
          </div>
          <div class="stat">
            <div class="label">‡∏à‡∏≤‡∏ß ‚õîÔ∏è</div>
            <div class="val">${stats.jao} (${stats.jaoPct}%)</div>
          </div>
        </div>

        <div class="legend">
          <span>‚úÖ = ‡∏ä‡∏ô‡∏∞</span>
          <span>‚ùå = ‡πÅ‡∏û‡πâ</span>
          <span>‚õîÔ∏è = ‡∏à‡∏≤‡∏ß</span>
        </div>

        <div class="history-list">${historyHtml}</div>
      `;
    }

    function renderAdminCampSelect() {
      const camps = getMergedCamps().sort((a, b) => a.name.localeCompare(b.name, "th"));
      el.recordCampSelect.innerHTML = "";
      camps.forEach(camp => {
        const opt = document.createElement("option");
        opt.value = camp.id;
        opt.textContent = camp.name;
        el.recordCampSelect.appendChild(opt);
      });
    }

    function refreshAdminUI() {
      if (state.isAdmin) {
        el.adminStateText.textContent = `‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß (${state.currentUserEmail})`;
        el.logoutBtn.style.display = "inline-block";
        el.adminLoginCard.style.display = "none";
        el.adminAddCampCard.style.display = "block";
        el.adminAddRecordCard.style.display = "block";
        renderAdminCampSelect();
      } else {
        if (state.currentUserEmail && !state.isAdmin) {
          el.adminStateText.textContent = `‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏≠‡∏¢‡∏π‡πà ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô (${state.currentUserEmail})`;
        } else {
          el.adminStateText.textContent = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö";
        }
        el.logoutBtn.style.display = state.currentUserEmail ? "inline-block" : "none";
        el.adminLoginCard.style.display = state.currentUserEmail ? "none" : "block";
        el.adminAddCampCard.style.display = "none";
        el.adminAddRecordCard.style.display = "none";
      }
    }

    function startRealtimeListeners() {
      onSnapshot(collection(db, "camps"), (snap) => {
        state.camps = snap.docs.map(d => ({ id: d.id, ...d.data() }));

        if (state.selectedCampId && !state.camps.some(c => c.id === state.selectedCampId)) {
          state.selectedCampId = null;
        } else if (!state.selectedCampId && state.camps.length) {
          state.selectedCampId = state.camps[0].id;
        }

        renderCampList();
        renderDetail();
        if (state.isAdmin) renderAdminCampSelect();
      }, (err) => {
        console.error("‡∏≠‡πà‡∏≤‡∏ô camps ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", err);
        alert("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (camps)\n" + (err.code || "") + "\n" + (err.message || ""));
      });

      onSnapshot(collection(db, "records"), (snap) => {
        state.records = snap.docs.map(d => ({ id: d.id, ...d.data() }));
        renderCampList();
        renderDetail();
      }, (err) => {
        console.error("‡∏≠‡πà‡∏≤‡∏ô records ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", err);
        alert("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (records)\n" + (err.code || "") + "\n" + (err.message || ""));
      });
    }

    async function handleLogin() {
      const email = el.adminEmailInput.value.trim();
      const password = el.adminPasswordInput.value;

      if (!email || !password) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô");
        return;
      }

      try {
        await signInWithEmailAndPassword(auth, email, password);
        el.adminPasswordInput.value = "";
      } catch (e) {
        console.error(e);
        alert("‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n" + (e.code || "") + "\n" + (e.message || ""));
      }
    }

    async function handleLogout() {
      try {
        await signOut(auth);
      } catch (e) {
        console.error(e);
        alert("‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      }
    }

    onAuthStateChanged(auth, (user) => {
      state.currentUserEmail = user?.email || null;
      state.isAdmin = !!(user?.email && user.email.toLowerCase() === ADMIN_EMAIL.toLowerCase());
      refreshAdminUI();
      renderCampList();
      renderDetail();
    });

    async function addCamp() {
      if (!state.isAdmin) return alert("‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô");
      const name = el.newCampName.value.trim();
      if (!name) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡∏¢");

      const exists = state.camps.some(c => (c.name || "").toLowerCase() === name.toLowerCase());
      if (exists) return alert("‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß");

      try {
        await addDoc(collection(db, "camps"), { name, createdAt: serverTimestamp() });
        el.newCampName.value = "";
        alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
      } catch (e) {
        console.error(e);
        alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤‡∏¢‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n" + (e.code || "") + "\n" + (e.message || ""));
      }
    }

    async function addRecord() {
      if (!state.isAdmin) return alert("‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô");

      const campId = el.recordCampSelect.value;
      const date = el.recordDate.value;
      const score = Number(el.recordScore.value);
      const result = el.recordResult.value;

      if (!campId) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡∏¢");
      if (!date) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà");
      if (Number.isNaN(score) || score < 0) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏™‡∏Å‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
      if (!["win","lose","jao"].includes(result)) return alert("‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");

      try {
        await addDoc(collection(db, "records"), {
          campId, date, score, result, createdAt: serverTimestamp()
        });
        state.selectedCampId = campId;
        el.recordScore.value = "";
        el.recordResult.value = "win";
        setDefaultDate();
        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
      } catch (e) {
        console.error(e);
        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n" + (e.code || "") + "\n" + (e.message || ""));
      }
    }

    async function editRecordById(recordId) {
      if (!state.isAdmin) return alert("‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô");
      const rec = state.records.find(r => r.id === recordId);
      if (!rec) return alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£");

      const newDate = prompt("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (YYYY-MM-DD)", rec.date || "");
      if (newDate === null) return;
      const newScoreRaw = prompt("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏Å‡∏≠‡∏£‡πå", String(rec.score ?? ""));
      if (newScoreRaw === null) return;
      const newResultRaw = prompt("‡πÅ‡∏Å‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: win / lose / jao", rec.result || "win");
      if (newResultRaw === null) return;

      const score = Number(newScoreRaw);
      const result = String(newResultRaw).trim().toLowerCase();

      if (!/^\d{4}-\d{2}-\d{2}$/.test(newDate)) return alert("‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô YYYY-MM-DD");
      if (Number.isNaN(score) || score < 0) return alert("‡∏™‡∏Å‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
      if (!["win","lose","jao"].includes(result)) return alert("‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô win / lose / jao");

      try {
        await updateDoc(doc(db, "records", recordId), { date: newDate, score, result });
        alert("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
      } catch (e) {
        console.error(e);
        alert("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n" + (e.code || "") + "\n" + (e.message || ""));
      }
    }

    async function deleteRecordById(recordId) {
      if (!state.isAdmin) return alert("‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô");
      const rec = state.records.find(r => r.id === recordId);
      if (!rec) return alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£");
      const camp = state.camps.find(c => c.id === rec.campId);

      const ok = confirm(`‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?\n‡∏Ñ‡πà‡∏≤‡∏¢: ${camp?.name || "-"}\n‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${rec.date}\n‡∏™‡∏Å‡∏≠‡∏£‡πå: ${rec.score}`);
      if (!ok) return;

      try {
        await deleteDoc(doc(db, "records", recordId));
        alert("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
      } catch (e) {
        console.error(e);
        alert("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n" + (e.code || "") + "\n" + (e.message || ""));
      }
    }

    async function renameSelectedCamp() {
      if (!state.isAdmin) return alert("‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô");
      const camp = state.selectedCampId ? state.camps.find(c => c.id === state.selectedCampId) : null;
      if (!camp) return alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡∏¢");

      const newName = prompt("‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡∏¢", camp.name || "");
      if (newName === null) return;
      const name = newName.trim();
      if (!name) return alert("‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡∏¢‡∏´‡πâ‡∏≤‡∏°‡∏ß‡πà‡∏≤‡∏á");

      const duplicate = state.camps.some(c => c.id !== camp.id && (c.name || "").toLowerCase() === name.toLowerCase());
      if (duplicate) return alert("‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß");

      try {
        await updateDoc(doc(db, "camps", camp.id), { name });
        alert("‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
      } catch (e) {
        console.error(e);
        alert("‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡∏¢‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n" + (e.code || "") + "\n" + (e.message || ""));
      }
    }

    async function deleteSelectedCamp() {
      if (!state.isAdmin) return alert("‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô");
      const camp = state.selectedCampId ? state.camps.find(c => c.id === state.selectedCampId) : null;
      if (!camp) return alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡∏¢");

      const ok = confirm(`‡∏•‡∏ö‡∏Ñ‡πà‡∏≤‡∏¢ "${camp.name}" ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?\n‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢`);
      if (!ok) return;

      try {
        const batch = writeBatch(db);
        batch.delete(doc(db, "camps", camp.id));

        const q = query(collection(db, "records"), where("campId", "==", camp.id));
        const snap = await getDocs(q);
        snap.forEach(d => batch.delete(doc(db, "records", d.id)));

        await batch.commit();
        state.selectedCampId = null;
        alert("‡∏•‡∏ö‡∏Ñ‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
      } catch (e) {
        console.error(e);
        alert("‡∏•‡∏ö‡∏Ñ‡πà‡∏≤‡∏¢‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n" + (e.code || "") + "\n" + (e.message || ""));
      }
    }

    // expose for inline buttons
    window.editRecordById = editRecordById;
    window.deleteRecordById = deleteRecordById;
    window.renameSelectedCamp = renameSelectedCamp;
    window.deleteSelectedCamp = deleteSelectedCamp;

    function openAdminModal() {
      el.adminModal.classList.add("show");
      refreshAdminUI();
    }
    function closeAdminModal() {
      el.adminModal.classList.remove("show");
    }

    // Events
    el.searchInput.addEventListener("input", () => {
      renderCampList();
    });

    el.clearSearchBtn.addEventListener("click", () => {
      el.searchInput.value = "";
      renderCampList();
    });

    el.adminFab.addEventListener("click", openAdminModal);
    el.closeAdminModal.addEventListener("click", closeAdminModal);
    el.adminModal.addEventListener("click", (e) => {
      if (e.target === el.adminModal) closeAdminModal();
    });

    el.loginBtn.addEventListener("click", handleLogin);
    el.adminPasswordInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") handleLogin();
    });
    el.logoutBtn.addEventListener("click", handleLogout);

    el.addCampBtn.addEventListener("click", addCamp);
    el.addRecordBtn.addEventListener("click", addRecord);

    // Start
    setDefaultDate();
    startRealtimeListeners();
  </script>
</body>
</html>
