<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ö‡∏±‡πâ‡∏á‡πÑ‡∏ü‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡∏¢</title>
  <style>
    :root {
      --bg: #0f172a;
      --card: rgba(255,255,255,0.05);
      --card-border: rgba(255,255,255,0.12);
      --text: #e5e7eb;
      --muted: #94a3b8;
      --primary: #38bdf8;
      --primary2: #22d3ee;
      --success: #22c55e;
      --danger: #ef4444;
      --warning: #f59e0b;
      --radius: 16px;
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Segoe UI", Tahoma, sans-serif;
      color: var(--text);
      background:
        radial-gradient(circle at 10% 10%, rgba(56,189,248,.12), transparent 35%),
        radial-gradient(circle at 90% 20%, rgba(34,211,238,.10), transparent 35%),
        var(--bg);
      min-height: 100vh;
    }

    .container {
      max-width: 1180px;
      margin: 0 auto;
      padding: 14px 14px 84px;
    }

    .header {
      background: linear-gradient(135deg, rgba(56,189,248,0.12), rgba(34,211,238,0.08));
      border: 1px solid var(--card-border);
      border-radius: 22px;
      padding: 18px;
      margin-bottom: 14px;
      box-shadow: var(--shadow);
    }

    .header h1 {
      margin: 0 0 4px;
      font-size: 1.4rem;
      font-weight: 800;
    }

    .header p {
      margin: 0;
      color: var(--muted);
      font-size: 0.92rem;
    }

    .search-box {
      margin-top: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      border: 1px solid var(--card-border);
      border-radius: 14px;
      padding: 10px 12px;
      background: rgba(255,255,255,.03);
    }

    .search-box input {
      width: 100%;
      border: none;
      outline: none;
      background: transparent;
      color: var(--text);
      font-size: 1rem;
    }
    .search-box input::placeholder { color: #9aa4b2; }

    .layout {
      display: grid;
      grid-template-columns: 1fr;
      gap: 14px;
    }

    @media (min-width: 950px) {
      .layout { grid-template-columns: 1.05fr 1fr; }
    }

    .panel {
      border: 1px solid var(--card-border);
      border-radius: 18px;
      overflow: hidden;
      background: rgba(255,255,255,.03);
      box-shadow: var(--shadow);
    }

    .panel-title {
      padding: 14px 16px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.02);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      font-weight: 700;
    }

    .panel-body { padding: 14px; }

    .muted { color: var(--muted); font-size: .88rem; }

    .camp-grid {
      display: grid;
      gap: 10px;
    }

    .camp-card {
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 14px;
      padding: 12px;
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items: center;
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015));
    }

    .camp-name {
      font-weight: 700;
      margin-bottom: 4px;
      word-break: break-word;
    }

    .camp-sub {
      color: var(--muted);
      font-size: .86rem;
    }

    .btn {
      border: none;
      cursor: pointer;
      color: white;
      font-weight: 700;
      border-radius: 12px;
      padding: 10px 12px;
      transition: .15s;
      white-space: nowrap;
    }
    .btn:hover { transform: translateY(-1px); }
    .btn-primary { background: linear-gradient(135deg, var(--primary), var(--primary2)); }
    .btn-success { background: linear-gradient(135deg, #16a34a, #22c55e); }
    .btn-secondary {
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.08);
    }
    .btn-danger { background: linear-gradient(135deg, #dc2626, #ef4444); }

    .btn-mini {
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color: var(--text);
      border-radius: 8px;
      padding: 4px 8px;
      font-size: .75rem;
      cursor: pointer;
    }
    .btn-mini:hover { background: rgba(255,255,255,.08); }
    .btn-mini-danger {
      border-color: rgba(239,68,68,.25);
      color: #fca5a5;
    }

    .detail-empty {
      border: 1px dashed rgba(255,255,255,.14);
      border-radius: 12px;
      color: var(--muted);
      text-align: center;
      padding: 24px 12px;
    }

    .detail-header h2 {
      margin: 0 0 4px;
      font-size: 1.1rem;
    }
    .detail-header .hint {
      color: var(--muted);
      font-size: .88rem;
      margin-bottom: 10px;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 8px;
      margin-bottom: 10px;
    }

    .stat-card {
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 12px;
      padding: 10px;
      background: rgba(255,255,255,.02);
    }

    .stat-card.big {
      grid-column: 1 / -1;
      background: linear-gradient(135deg, rgba(56,189,248,.12), rgba(34,211,238,.06));
      border-color: rgba(56,189,248,.22);
    }

    .stat-label { color: var(--muted); font-size: .8rem; margin-bottom: 4px; }
    .stat-value { font-weight: 800; }

    .legend {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }

    .legend-badge {
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 999px;
      padding: 5px 10px;
      font-size: .82rem;
      background: rgba(255,255,255,.02);
    }

    .history-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 450px;
      overflow: auto;
      padding-right: 4px;
    }

    .history-item {
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 12px;
      padding: 10px;
      background: rgba(255,255,255,.02);
    }

    .history-line {
      font-weight: 700;
      margin-bottom: 6px;
      word-break: break-word;
    }

    .history-meta {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
      color: var(--muted);
      font-size: .84rem;
    }

    .badge {
      padding: 4px 8px;
      border-radius: 999px;
      font-size: .78rem;
      font-weight: 700;
      border: 1px solid transparent;
    }
    .badge-win  { background: rgba(34,197,94,.12); color: #86efac; border-color: rgba(34,197,94,.25); }
    .badge-lose { background: rgba(239,68,68,.12); color: #fca5a5; border-color: rgba(239,68,68,.25); }
    .badge-jao  { background: rgba(245,158,11,.12); color: #fde68a; border-color: rgba(245,158,11,.25); }

    .admin-fab {
      position: fixed;
      right: 16px;
      bottom: 16px;
      z-index: 50;
      border: none;
      cursor: pointer;
      color: white;
      font-weight: 800;
      border-radius: 999px;
      padding: 12px 14px;
      background: linear-gradient(135deg, #7c3aed, #2563eb);
      box-shadow: 0 12px 24px rgba(37,99,235,.35);
    }

    .modal {
      position: fixed;
      inset: 0;
      background: rgba(2,6,23,.75);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
      padding: 16px;
    }
    .modal.show { display: flex; }

    .modal-card {
      width: min(760px, 100%);
      max-height: 92vh;
      overflow: auto;
      border-radius: 18px;
      background: #0b1220;
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow);
    }

    .modal-header {
      padding: 14px 16px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .icon-btn {
      border: 1px solid rgba(255,255,255,.12);
      background: transparent;
      color: var(--text);
      border-radius: 10px;
      padding: 6px 10px;
      cursor: pointer;
    }

    .modal-body { padding: 14px; display: grid; gap: 12px; }

    .form-card {
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 14px;
      background: rgba(255,255,255,.02);
      padding: 12px;
    }

    .form-card h3 { margin: 0 0 10px; font-size: .98rem; }

    .form-grid {
      display: grid;
      gap: 8px;
      grid-template-columns: 1fr;
    }

    @media (min-width: 700px) {
      .form-grid.cols-2 { grid-template-columns: 1fr 1fr; }
      .form-grid.cols-3 { grid-template-columns: 1fr 1fr 1fr; }
    }

    .field { display: grid; gap: 6px; }
    .field label { color: var(--muted); font-size: .84rem; }

    .field input, .field select {
      width: 100%;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      color: var(--text);
      padding: 10px 12px;
      outline: none;
    }

    .actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 8px;
    }

    .status-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .note {
      margin-top: 6px;
      color: var(--muted);
      font-size: .82rem;
    }

    .footer-note {
      margin-top: 10px;
      color: var(--muted);
      font-size: .82rem;
    }

    .loading {
      color: var(--muted);
      padding: 10px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <section class="header">
      <h1>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ö‡∏±‡πâ‡∏á‡πÑ‡∏ü‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡∏¢</h1>
      <p>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏∏‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á ‚Ä¢ ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</p>

      <div class="search-box">
        <span>üîé</span>
        <input id="searchInput" type="text" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡∏¢... ‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏ö‡∏á‡∏Ñ‡πå‡∏ó‡∏≠‡∏á" />
      </div>
    </section>

    <div class="layout">
      <section class="panel">
        <div class="panel-title">
          <span>‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡∏¢</span>
          <span id="campCount" class="muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
        </div>
        <div class="panel-body">
          <div id="campList" class="camp-grid">
            <div class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
          </div>
        </div>
      </section>

      <section class="panel">
        <div class="panel-title">
          <span>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡πà‡∏≤‡∏¢</span>
          <span id="selectedCampTag" class="muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</span>
        </div>
        <div class="panel-body" id="detailPanel">
          <div class="detail-empty">
            ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î <b>‚Äú‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‚Äù</b> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏¢‡∏¥‡∏á
          </div>
        </div>
      </section>
    </div>

    <div class="footer-note">‚úÖ = ‡∏ä‡∏ô‡∏∞ ‚Ä¢ ‚ùå = ‡πÅ‡∏û‡πâ ‚Ä¢ ‚õîÔ∏è = ‡∏à‡∏≤‡∏ß</div>
  </div>

  <button id="adminFab" class="admin-fab">üîê ‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</button>

  <!-- Admin Modal -->
  <div id="adminModal" class="modal">
    <div class="modal-card">
      <div class="modal-header">
        <div><b>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô)</b></div>
        <button id="closeAdminModal" class="icon-btn">‡∏õ‡∏¥‡∏î</button>
      </div>

      <div class="modal-body">
        <div class="status-row">
          <div id="adminStateText" class="muted">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</div>
          <button id="logoutBtn" class="btn btn-secondary" style="display:none;">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>

        <!-- Login -->
        <div id="adminLoginCard" class="form-card">
          <h3>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h3>
          <div class="form-grid cols-2">
            <div class="field" style="grid-column: 1 / -1;">
              <label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</label>
              <input type="email" id="adminEmailInput" placeholder="admin@email.com" />
            </div>
            <div class="field" style="grid-column: 1 / -1;">
              <label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
              <input type="password" id="adminPasswordInput" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô" />
            </div>
          </div>
          <div class="actions">
            <button id="loginBtn" class="btn btn-primary">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
          </div>
          <div class="note">‡πÉ‡∏ä‡πâ Firebase Authentication (Email/Password)</div>
        </div>

        <!-- Add Camp -->
        <div id="adminAddCampCard" class="form-card" style="display:none;">
          <h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà</h3>
          <div class="form-grid cols-2">
            <div class="field" style="grid-column: 1 / -1;">
              <label>‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡∏¢</label>
              <input type="text" id="newCampName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏ö‡∏á‡∏Ñ‡πå‡∏ó‡∏≠‡∏á" />
            </div>
          </div>
          <div class="actions">
            <button id="addCampBtn" class="btn btn-success">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤‡∏¢</button>
          </div>
        </div>

        <!-- Add Record -->
        <div id="adminAddRecordCard" class="form-card" style="display:none;">
          <h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ / ‡∏™‡∏Å‡∏≠‡∏£‡πå‡∏ö‡∏±‡πâ‡∏á‡πÑ‡∏ü</h3>

          <div class="form-grid cols-3">
            <div class="field">
              <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡∏¢</label>
              <select id="recordCampSelect"></select>
            </div>
            <div class="field">
              <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
              <input type="date" id="recordDate" />
            </div>
            <div class="field">
              <label>‡∏™‡∏Å‡∏≠‡∏£‡πå</label>
              <input type="number" id="recordScore" min="0" placeholder="‡πÄ‡∏ä‡πà‡∏ô 355" />
            </div>

            <div class="field">
              <label>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</label>
              <select id="recordResult">
                <option value="win">‚úÖ ‡∏ä‡∏ô‡∏∞</option>
                <option value="lose">‚ùå ‡πÅ‡∏û‡πâ</option>
                <option value="jao">‚õîÔ∏è ‡∏à‡∏≤‡∏ß</option>
              </select>
            </div>
          </div>

          <div class="actions">
            <button id="addRecordBtn" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>
          </div>

          <div class="note">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•: 24/02/69 &gt; ‡πÅ‡∏ö‡∏á‡∏Ñ‡πå‡∏ó‡∏≠‡∏á = 355 ‚õîÔ∏è‚õîÔ∏è</div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    // =========================
    // Firebase SDK (CDN)
    // =========================
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getAuth,
      signInWithEmailAndPassword,
      signOut,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import {
      getFirestore,
      collection,
      addDoc,
      onSnapshot,
      serverTimestamp,
      doc,
      updateDoc,
      deleteDoc,
      query,
      where,
      getDocs,
      writeBatch
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // =========================
    // Firebase Config
    // =========================
    const firebaseConfig = {
      apiKey: "AIzaSyBo2QyLIW5q6AFAtTYLrqBr5wgssYvwgPI",
      authDomain: "webscorebungfire.firebaseapp.com",
      projectId: "webscorebungfire",
      storageBucket: "webscorebungfire.firebasestorage.app",
      messagingSenderId: "1088110071642",
      appId: "1:1088110071642:web:037a36b00e84aa432ead63"
    };

    // ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÉ‡∏ô Firebase Authentication ‡πÅ‡∏•‡∏∞ Firestore Rules
    const ADMIN_EMAIL = "thebungnot10@gmail.com";

    // =========================
    // Init Firebase
    // =========================
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // =========================
    // State
    // =========================
    const state = {
      camps: [],
      records: [],
      selectedCampId: null,
      isAdmin: false,
      currentUserEmail: null
    };

    const RESULT_META = {
      win:  { label: "‡∏ä‡∏ô‡∏∞", icon: "‚úÖ", className: "badge-win", weight: 1.0 },
      lose: { label: "‡πÅ‡∏û‡πâ", icon: "‚ùå", className: "badge-lose", weight: 0.0 },
      jao:  { label: "‡∏à‡∏≤‡∏ß", icon: "‚õîÔ∏è", className: "badge-jao", weight: 0.4 }
    };

    // =========================
    // DOM
    // =========================
    const el = {
      searchInput: document.getElementById("searchInput"),
      campList: document.getElementById("campList"),
      campCount: document.getElementById("campCount"),
      detailPanel: document.getElementById("detailPanel"),
      selectedCampTag: document.getElementById("selectedCampTag"),

      adminFab: document.getElementById("adminFab"),
      adminModal: document.getElementById("adminModal"),
      closeAdminModal: document.getElementById("closeAdminModal"),
      adminStateText: document.getElementById("adminStateText"),
      logoutBtn: document.getElementById("logoutBtn"),

      adminLoginCard: document.getElementById("adminLoginCard"),
      adminAddCampCard: document.getElementById("adminAddCampCard"),
      adminAddRecordCard: document.getElementById("adminAddRecordCard"),

      adminEmailInput: document.getElementById("adminEmailInput"),
      adminPasswordInput: document.getElementById("adminPasswordInput"),
      loginBtn: document.getElementById("loginBtn"),

      newCampName: document.getElementById("newCampName"),
      addCampBtn: document.getElementById("addCampBtn"),

      recordCampSelect: document.getElementById("recordCampSelect"),
      recordDate: document.getElementById("recordDate"),
      recordScore: document.getElementById("recordScore"),
      recordResult: document.getElementById("recordResult"),
      addRecordBtn: document.getElementById("addRecordBtn")
    };

    // =========================
    // Helpers
    // =========================
    function setDefaultDate() {
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      el.recordDate.value = `${y}-${m}-${day}`;
    }

    function formatThaiShort(isoDate) {
      if (!isoDate) return "-";
      const d = new Date(isoDate + "T00:00:00");
      if (isNaN(d.getTime())) return isoDate;
      const dd = String(d.getDate()).padStart(2, "0");
      const mm = String(d.getMonth() + 1).padStart(2, "0");
      const yy = String(d.getFullYear() + 543).slice(-2);
      return `${dd}/${mm}/${yy}`;
    }

    function getMergedCamps() {
      const map = new Map();

      for (const camp of state.camps) {
        map.set(camp.id, { ...camp, records: [] });
      }

      for (const rec of state.records) {
        const target = map.get(rec.campId);
        if (target) target.records.push(rec);
      }

      return Array.from(map.values());
    }

    function getCampById(campId) {
      return getMergedCamps().find(c => c.id === campId) || null;
    }

    function sortRecords(records) {
      return [...records].sort((a, b) => {
        if ((a.date || "") === (b.date || "")) return (b.score || 0) - (a.score || 0);
        return (b.date || "").localeCompare(a.date || "");
      });
    }

    function getStats(camp) {
      const total = camp.records.length;
      const win = camp.records.filter(r => r.result === "win").length;
      const lose = camp.records.filter(r => r.result === "lose").length;
      const jao = camp.records.filter(r => r.result === "jao").length;
      const avgScore = total
        ? Math.round(camp.records.reduce((sum, r) => sum + (Number(r.score) || 0), 0) / total)
        : 0;

      const weighted = total
        ? Math.round((camp.records.reduce((sum, r) => sum + (RESULT_META[r.result]?.weight ?? 0), 0) / total) * 100)
        : 0;

      return {
        total, win, lose, jao, avgScore, weighted,
        winPct: total ? Math.round((win / total) * 100) : 0,
        losePct: total ? Math.round((lose / total) * 100) : 0,
        jaoPct: total ? Math.round((jao / total) * 100) : 0
      };
    }

    function escapeHtml(text) {
      return String(text)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    // =========================
    // Render
    // =========================
    function renderCampList() {
      const merged = getMergedCamps();

      const sortedByRecords = [...merged].sort((a, b) => {
        const diff = (b.records?.length || 0) - (a.records?.length || 0);
        if (diff !== 0) return diff;
        return (a.name || "").localeCompare(b.name || "", "th");
      });

      const q = el.searchInput.value.trim().toLowerCase();
      let visible = [];

      if (q) {
        visible = sortedByRecords.filter(c => (c.name || "").toLowerCase().includes(q));
        el.campCount.textContent = `‡∏ú‡∏•‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ${visible.length} / ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${merged.length} ‡∏Ñ‡πà‡∏≤‡∏¢`;
      } else {
        visible = sortedByRecords.slice(0, 3);
        el.campCount.textContent = `‡πÅ‡∏™‡∏î‡∏á 3 ‡∏Ñ‡πà‡∏≤‡∏¢ (‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${merged.length} ‡∏Ñ‡πà‡∏≤‡∏¢)`;
      }

      el.campList.innerHTML = "";

      if (!visible.length) {
        const div = document.createElement("div");
        div.className = "muted";
        div.textContent = q ? "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤" : "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏¢";
        el.campList.appendChild(div);
        return;
      }

      for (const camp of visible) {
        const stats = getStats(camp);

        const card = document.createElement("div");
        card.className = "camp-card";

        const left = document.createElement("div");
        left.innerHTML = `
          <div class="camp-name">${escapeHtml(camp.name)}</div>
          <div class="camp-sub">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${stats.total} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‚Ä¢ ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏£‡∏ß‡∏° ${stats.weighted}%</div>
        `;

        const btn = document.createElement("button");
        btn.className = "btn btn-primary";
        btn.textContent = "‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ";
        btn.onclick = () => {
          state.selectedCampId = camp.id;
          renderDetail();
        };

        card.appendChild(left);
        card.appendChild(btn);
        el.campList.appendChild(card);
      }
    }

    function renderDetail() {
      const camp = state.selectedCampId ? getCampById(state.selectedCampId) : null;

      if (!camp) {
        el.selectedCampTag.textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å";
        el.detailPanel.innerHTML = `
          <div class="detail-empty">
            ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î <b>‚Äú‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‚Äù</b> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏¢‡∏¥‡∏á
          </div>
        `;
        return;
      }

      el.selectedCampTag.textContent = camp.name;
      const stats = getStats(camp);
      const rows = sortRecords(camp.records);

      let historyHtml = "";
      if (!rows.length) {
        historyHtml = `<div class="detail-empty">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡∏¢‡∏ô‡∏µ‡πâ</div>`;
      } else {
        historyHtml = rows.map(r => {
          const meta = RESULT_META[r.result] || RESULT_META.lose;
          return `
            <div class="history-item">
              <div class="history-line">${formatThaiShort(r.date)} &gt; ${escapeHtml(camp.name)} = ${r.score} ${meta.icon}${meta.icon}</div>
              <div class="history-meta">
                <span class="badge ${meta.className}">${meta.icon} ${meta.label}</span>
                <span>‡∏™‡∏Å‡∏≠‡∏£‡πå: ${r.score}</span>
                ${state.isAdmin ? `
                  <span style="margin-left:auto; display:flex; gap:6px;">
                    <button class="btn-mini" onclick="window.editRecordById('${r.id}')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                    <button class="btn-mini btn-mini-danger" onclick="window.deleteRecordById('${r.id}')">‡∏•‡∏ö</button>
                  </span>
                ` : ""}
              </div>
            </div>
          `;
        }).join("");
      }

      el.detailPanel.innerHTML = `
        <div class="detail-header">
          <h2>${escapeHtml(camp.name)}</h2>
          <div class="hint">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå</div>
          ${state.isAdmin ? `
            <div class="actions" style="margin-top:6px;">
              <button class="btn-mini" onclick="window.renameSelectedCamp()">‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡∏¢</button>
              <button class="btn-mini btn-mini-danger" onclick="window.deleteSelectedCamp()">‡∏•‡∏ö‡∏Ñ‡πà‡∏≤‡∏¢</button>
            </div>
          ` : ""}
        </div>

        <div class="stats">
          <div class="stat-card big">
            <div class="stat-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏£‡∏ß‡∏°</div>
            <div class="stat-value">${stats.weighted}%</div>
          </div>

          <div class="stat-card">
            <div class="stat-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
            <div class="stat-value">${stats.total} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
          </div>

          <div class="stat-card">
            <div class="stat-label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div>
            <div class="stat-value">${stats.avgScore}</div>
          </div>

          <div class="stat-card">
            <div class="stat-label">‡∏ä‡∏ô‡∏∞ ‚úÖ</div>
            <div class="stat-value">${stats.win} (${stats.winPct}%)</div>
          </div>

          <div class="stat-card">
            <div class="stat-label">‡πÅ‡∏û‡πâ ‚ùå</div>
            <div class="stat-value">${stats.lose} (${stats.losePct}%)</div>
          </div>

          <div class="stat-card">
            <div class="stat-label">‡∏à‡∏≤‡∏ß ‚õîÔ∏è</div>
            <div class="stat-value">${stats.jao} (${stats.jaoPct}%)</div>
          </div>
        </div>

        <div class="legend">
          <div class="legend-badge">‚úÖ = ‡∏ä‡∏ô‡∏∞</div>
          <div class="legend-badge">‚ùå = ‡πÅ‡∏û‡πâ</div>
          <div class="legend-badge">‚õîÔ∏è = ‡∏à‡∏≤‡∏ß</div>
        </div>

        <div class="history-list">${historyHtml}</div>
      `;
    }

    function renderAdminCampSelect() {
      const camps = getMergedCamps().sort((a, b) => a.name.localeCompare(b.name, "th"));
      el.recordCampSelect.innerHTML = "";

      for (const camp of camps) {
        const opt = document.createElement("option");
        opt.value = camp.id;
        opt.textContent = camp.name;
        el.recordCampSelect.appendChild(opt);
      }
    }

    function refreshAdminUI() {
      if (state.isAdmin) {
        el.adminStateText.textContent = `‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß (${state.currentUserEmail})`;
        el.logoutBtn.style.display = "inline-block";
        el.adminLoginCard.style.display = "none";
        el.adminAddCampCard.style.display = "block";
        el.adminAddRecordCard.style.display = "block";
        renderAdminCampSelect();
      } else {
        if (state.currentUserEmail && !state.isAdmin) {
          el.adminStateText.textContent = `‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏≠‡∏¢‡∏π‡πà ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô (${state.currentUserEmail})`;
        } else {
          el.adminStateText.textContent = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö";
        }
        el.logoutBtn.style.display = state.currentUserEmail ? "inline-block" : "none";
        el.adminLoginCard.style.display = state.currentUserEmail ? "none" : "block";
        el.adminAddCampCard.style.display = "none";
        el.adminAddRecordCard.style.display = "none";
      }
    }

    // =========================
    // Firebase Realtime Listeners
    // =========================
    function startRealtimeListeners() {
      onSnapshot(collection(db, "camps"), (snap) => {
        state.camps = snap.docs.map(d => ({ id: d.id, ...d.data() }));

        if (state.selectedCampId && !state.camps.some(c => c.id === state.selectedCampId)) {
          state.selectedCampId = null;
        } else if (!state.selectedCampId && state.camps.length) {
          state.selectedCampId = state.camps[0].id;
        }

        renderCampList();
        renderDetail();
        if (state.isAdmin) renderAdminCampSelect();
      }, (err) => {
        console.error("‡∏≠‡πà‡∏≤‡∏ô camps ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", err);
        alert("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (camps)\n" + (err.code || "") + "\n" + (err.message || ""));
      });

      onSnapshot(collection(db, "records"), (snap) => {
        state.records = snap.docs.map(d => ({ id: d.id, ...d.data() }));
        renderCampList();
        renderDetail();
      }, (err) => {
        console.error("‡∏≠‡πà‡∏≤‡∏ô records ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", err);
        alert("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (records)\n" + (err.code || "") + "\n" + (err.message || ""));
      });
    }

    // =========================
    // Auth
    // =========================
    async function handleLogin() {
      const email = el.adminEmailInput.value.trim();
      const password = el.adminPasswordInput.value;

      if (!email || !password) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô");
        return;
      }

      try {
        await signInWithEmailAndPassword(auth, email, password);
        el.adminPasswordInput.value = "";
      } catch (e) {
        console.error(e);
        alert("‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:\n" + (e.code || "") + "\n" + (e.message || ""));
      }
    }

    async function handleLogout() {
      try {
        await signOut(auth);
      } catch (e) {
        console.error(e);
        alert("‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      }
    }

    onAuthStateChanged(auth, (user) => {
      state.currentUserEmail = user?.email || null;
      state.isAdmin = !!(user?.email && user.email.toLowerCase() === ADMIN_EMAIL.toLowerCase());
      refreshAdminUI();
      renderDetail();   // ‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ/‡∏•‡∏ö‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
      renderCampList();
    });

    // =========================
    // Admin actions (Create)
    // =========================
    async function addCamp() {
      if (!state.isAdmin) return alert("‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô");

      const name = el.newCampName.value.trim();
      if (!name) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡∏¢");

      const exists = state.camps.some(c => (c.name || "").toLowerCase() === name.toLowerCase());
      if (exists) return alert("‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß");

      try {
        await addDoc(collection(db, "camps"), {
          name,
          createdAt: serverTimestamp()
        });
        el.newCampName.value = "";
        alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
      } catch (e) {
        console.error(e);
        alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤‡∏¢‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n" + (e.code || "") + "\n" + (e.message || ""));
      }
    }

    async function addRecord() {
      if (!state.isAdmin) return alert("‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô");

      const campId = el.recordCampSelect.value;
      const date = el.recordDate.value;
      const score = Number(el.recordScore.value);
      const result = el.recordResult.value;

      if (!campId) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡∏¢");
      if (!date) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà");
      if (Number.isNaN(score) || score < 0) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏™‡∏Å‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
      if (!["win", "lose", "jao"].includes(result)) return alert("‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");

      const camp = state.camps.find(c => c.id === campId);
      if (!camp) return alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡πà‡∏≤‡∏¢");

      try {
        await addDoc(collection(db, "records"), {
          campId,
          date,
          score,
          result,
          createdAt: serverTimestamp()
        });

        el.recordScore.value = "";
        el.recordResult.value = "win";
        setDefaultDate();

        state.selectedCampId = campId;
        renderDetail();

        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
      } catch (e) {
        console.error(e);
        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n" + (e.code || "") + "\n" + (e.message || ""));
      }
    }

    // =========================
    // Admin actions (Edit/Delete)
    // =========================
    async function editRecordById(recordId) {
      if (!state.isAdmin) return alert("‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô");

      const rec = state.records.find(r => r.id === recordId);
      if (!rec) return alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£");

      const camp = state.camps.find(c => c.id === rec.campId);

      const newDate = prompt("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (YYYY-MM-DD)", rec.date || "");
      if (newDate === null) return;

      const newScoreRaw = prompt("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏Å‡∏≠‡∏£‡πå", String(rec.score ?? ""));
      if (newScoreRaw === null) return;

      const newResultRaw = prompt("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: win / lose / jao", rec.result || "win");
      if (newResultRaw === null) return;

      const score = Number(newScoreRaw);
      const result = String(newResultRaw).trim().toLowerCase();

      if (!/^\d{4}-\d{2}-\d{2}$/.test(newDate)) {
        return alert("‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô YYYY-MM-DD");
      }
      if (Number.isNaN(score) || score < 0) {
        return alert("‡∏™‡∏Å‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
      }
      if (!["win", "lose", "jao"].includes(result)) {
        return alert("‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô win / lose / jao");
      }

      try {
        await updateDoc(doc(db, "records", recordId), {
          date: newDate,
          score,
          result
        });
        alert(`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á ${camp?.name || "‡∏Ñ‡πà‡∏≤‡∏¢"} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`);
      } catch (e) {
        console.error(e);
        alert("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n" + (e.code || "") + "\n" + (e.message || ""));
      }
    }

    async function deleteRecordById(recordId) {
      if (!state.isAdmin) return alert("‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô");

      const rec = state.records.find(r => r.id === recordId);
      if (!rec) return alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£");
      const camp = state.camps.find(c => c.id === rec.campId);

      const ok = confirm(
        `‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?\n‡∏Ñ‡πà‡∏≤‡∏¢: ${camp?.name || "-"}\n‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${rec.date}\n‡∏™‡∏Å‡∏≠‡∏£‡πå: ${rec.score}`
      );
      if (!ok) return;

      try {
        await deleteDoc(doc(db, "records", recordId));
        alert("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
      } catch (e) {
        console.error(e);
        alert("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n" + (e.code || "") + "\n" + (e.message || ""));
      }
    }

    async function renameSelectedCamp() {
      if (!state.isAdmin) return alert("‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô");

      const camp = state.selectedCampId ? state.camps.find(c => c.id === state.selectedCampId) : null;
      if (!camp) return alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡∏¢");

      const newName = prompt("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡∏¢", camp.name || "");
      if (newName === null) return;

      const name = newName.trim();
      if (!name) return alert("‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡∏¢‡∏´‡πâ‡∏≤‡∏°‡∏ß‡πà‡∏≤‡∏á");

      const duplicate = state.camps.some(c => c.id !== camp.id && (c.name || "").toLowerCase() === name.toLowerCase());
      if (duplicate) return alert("‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß");

      try {
        await updateDoc(doc(db, "camps", camp.id), { name });
        alert("‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
      } catch (e) {
        console.error(e);
        alert("‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡∏¢‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n" + (e.code || "") + "\n" + (e.message || ""));
      }
    }

    async function deleteSelectedCamp() {
      if (!state.isAdmin) return alert("‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô");

      const camp = state.selectedCampId ? state.camps.find(c => c.id === state.selectedCampId) : null;
      if (!camp) return alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡∏¢");

      const ok = confirm(`‡∏•‡∏ö‡∏Ñ‡πà‡∏≤‡∏¢ "${camp.name}" ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?\n‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢`);
      if (!ok) return;

      try {
        const batch = writeBatch(db);

        // ‡∏•‡∏ö‡∏Ñ‡πà‡∏≤‡∏¢
        batch.delete(doc(db, "camps", camp.id));

        // ‡∏•‡∏ö records ‡∏Ç‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        const q = query(collection(db, "records"), where("campId", "==", camp.id));
        const snap = await getDocs(q);
        snap.forEach(d => {
          batch.delete(doc(db, "records", d.id));
        });

        await batch.commit();
        state.selectedCampId = null;
        alert("‡∏•‡∏ö‡∏Ñ‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
      } catch (e) {
        console.error(e);
        alert("‡∏•‡∏ö‡∏Ñ‡πà‡∏≤‡∏¢‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n" + (e.code || "") + "\n" + (e.message || ""));
      }
    }

    // ‡πÉ‡∏´‡πâ innerHTML onclick ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÑ‡∏î‡πâ (‡πÄ‡∏û‡∏£‡∏≤‡∏∞ script ‡πÄ‡∏õ‡πá‡∏ô module)
    window.editRecordById = editRecordById;
    window.deleteRecordById = deleteRecordById;
    window.renameSelectedCamp = renameSelectedCamp;
    window.deleteSelectedCamp = deleteSelectedCamp;

    // =========================
    // Modal
    // =========================
    function openAdminModal() {
      el.adminModal.classList.add("show");
      refreshAdminUI();
    }

    function closeAdminModal() {
      el.adminModal.classList.remove("show");
    }

    // =========================
    // Events
    // =========================
    el.searchInput.addEventListener("input", renderCampList);

    el.adminFab.addEventListener("click", openAdminModal);
    el.closeAdminModal.addEventListener("click", closeAdminModal);
    el.adminModal.addEventListener("click", (e) => {
      if (e.target === el.adminModal) closeAdminModal();
    });

    el.loginBtn.addEventListener("click", handleLogin);
    el.adminPasswordInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") handleLogin();
    });
    el.logoutBtn.addEventListener("click", handleLogout);

    el.addCampBtn.addEventListener("click", addCamp);
    el.addRecordBtn.addEventListener("click", addRecord);

    // =========================
    // Start
    // =========================
    setDefaultDate();
    startRealtimeListeners();
  </script>
</body>
</html>
